---
title: "p8105_hw2_smi2112"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Problem 1

Read and clean the data:

```{r}
library(tidyverse)
transit_data = read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1:route11, entry, vending, entrance_type, ada) %>% 
  mutate(entry = if_else(entry == "YES", TRUE, FALSE))
```

Short paragraph:

... these data are not tidy yet ...........

Number of distinct stations: 465

```{r}
transit_data %>% 
  select(line, station_name) %>% 
  n_distinct()
```

Number of ADA compliant stations: 84

```{r}
transit_data %>%
  select(line, station_name, ada) %>% 
  group_by(line, station_name) %>% 
  filter(ada == TRUE) %>% 
  n_distinct()
```

Proportion of station entrances/exits without vending allowed entrace: 0.0980

```{r}
38.7

prop.table(table(transit_data$vending))*100
```

Reformat data:

```{r}
transit_data_tidy = gather(transit_data, key = route_number, value = route_name, route1:route11) %>% 
  mutate(route_number = recode(route_number, 
                               "route1" = 1, 
                               "route2" = 2, 
                               "route3" = 3,
                               "route4" = 4, 
                               "route5" = 5, 
                               "route6" = 6, 
                               "route7" = 7, 
                               "route8" = 8, 
                               "route9" = 9, 
                               "route10" = 10, 
                               "route11" = 11)) 

is.numeric(transit_data_tidy$route_number)
is.character(transit_data_tidy$route_name)
```

Number of distinct stations serving the A train: 60

```{r}
transit_data_tidy %>%
  select(line, station_name, route_name) %>% 
  filter(route_name == "A") %>% 
  n_distinct()
```

Number of distinct stations serving the A train that are ADA compliant: 17

```{r}
transit_data_tidy %>%
  select(line, station_name, route_name, ada) %>% 
  filter(route_name == "A" & ada == TRUE) %>% 
  n_distinct()
```

##Problem 2

Reading and cleaning the Mr. Trash Wheel sheet:

```{r}
library(readxl)

mr_trash = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", "Mr. Trash Wheel", range = cell_cols("A:M")) %>%
  janitor::clean_names() %>% 
  filter(., !is.na(dumpster))

round(mr_trash$sports_balls) %>% 
  as.integer(mr_trash$sports_balls)

```


Reading and cleaning the precipitation data for 2016 and 2017:

```{r}
precip_2016 = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", "2016 Precipitation", range = cell_rows(2:14)) %>% 
  janitor::clean_names() %>% 
  mutate(year = 2016)

precip_2017 = read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", "2017 Precipitation", range = cell_rows(2:14)) %>% 
  janitor::clean_names() %>% 
  mutate(year = 2017)

month_info = tibble(
  month = 1:12, 
  month_name = month.name)

precip = union(precip_2016, precip_2017, by = "month") %>% 
  inner_join(., month_info, by = "month") %>% 
  select(-"month")
```

Paragraph about these data:

There are `r nrow(mr_trash)` observations in the Mr. Trash Wheel dataset. There are `r nrow(precip)` observations in the precipitation dataset. 
Some key variables of interest are as follows: 

Key variables:

There was `r precip %>% select(total, year) %>% filter(year == 2017) %>% summarise(sum(total))` inches of precipitation in 2017. The median number of sports balls in a dumpster in 2016 was `r mr_trash %>% select(year, sports_balls) %>% filter(year == 2016) %>% summarise(median(sports_balls))`.

##Problem 3

Loading BRFSS data from p8105.datasets package:

```{r cache = TRUE}
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
data("brfss_smart2010")
```

Formatting the data:

```{r}
brfss = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  rename(state = locationabbr, county = locationdesc) %>% 
  select(response, everything()) %>% 
  select(-class, -topic, -question, -sample_size, -c(confidence_limit_low:geo_location)) %>% 
  spread(key = response, value = data_value) %>% 
  janitor::clean_names() %>% 
  mutate(excellent_verygood = excellent + very_good)
```

There are `r brfss %>% select(state, county) %>% n_distinct()` unique locations. 

There are `r brfss %>% select(state) %>% n_distinct()` states. Every state is represented, with Washington DC represented as well.

```{r}
brfss %>% 
  select(state) %>% 
  group_by(state) %>% 
  count(state) %>% 
  arrange(desc(n))
```

New Jersey has the most observations.

In 2002, the median of the "Excellent" response value was `r brfss %>% select(year, excellent) %>% filter(year == 2002) %>% summarise(median(excellent, na.rm = TRUE))`.

Histogram of "Excellent" response values in the year 2002:

```{r}
brfss %>% 
  filter(year == 2002) %>% 
  ggplot(., aes(x = excellent)) + geom_histogram()
```

Scatterplot of proportion of "Excellent" response values in New York County and Queens county in each year from 2002 to 2010:

```{r}
brfss %>% 
  filter(county == "NY - New York County" | county == "NY - Queens County") %>% 
  ggplot(., aes(x = year, y = excellent, color = county)) + geom_point()
```

